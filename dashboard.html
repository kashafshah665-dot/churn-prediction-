<!DOCTYPE html>
<html lang="en">
<head>
<meta charset="UTF-8">
<title>GymFlow |</title>
<meta name="viewport" content="width=device-width, initial-scale=1.0">
<script src="https://cdn.jsdelivr.net/npm/chart.js"></script>
<link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.0.0/css/all.min.css">

<style>
/* ============ MODERN DARK THEME 2024 ============ */
@import url('https://fonts.googleapis.com/css2?family=Inter:wght@300;400;500;600;700;800&display=swap');

* {
    margin: 0;
    padding: 0;
    box-sizing: border-box;
}

body {
    font-family: 'Inter', -apple-system, BlinkMacSystemFont, sans-serif;
    background: radial-gradient(circle at 20% 50%, #0f172a, #0a0f1a);
    color: #fff;
    line-height: 1.6;
    min-height: 100vh;
    display: flex;
}

.container {
    max-width: 1440px;
    margin: 0 auto;
    padding: 35px 40px;
}

/* ============ TYPOGRAPHY ============ */
h2 {
    font-size: 2.2rem;
    font-weight: 700;
    margin-bottom: 15px;
    background: linear-gradient(135deg, #ffffff, #94a3b8);
    -webkit-background-clip: text;
    -webkit-text-fill-color: transparent;
    letter-spacing: -1px;
    display: flex;
    align-items: center;
    gap: 12px;
}

h2 i {
    background: linear-gradient(135deg, #4a9eff, #3b82f6);
    -webkit-background-clip: text;
    -webkit-text-fill-color: transparent;
    font-size: 2rem;
}

h3 {
    font-size: 1.3rem;
    font-weight: 600;
    color: #fff;
    margin-bottom: 20px;
    display: flex;
    align-items: center;
    gap: 10px;
}

/* ============ KPI CARDS - GLASS MORPHISM ============ */
.row {
    display: grid;
    grid-template-columns: repeat(4, 1fr);
    gap: 25px;
    margin-bottom: 35px;
}

.card {
    background: linear-gradient(145deg, rgba(30, 41, 59, 0.8), rgba(15, 23, 42, 0.9));
    backdrop-filter: blur(10px);
    border: 1px solid rgba(74, 158, 255, 0.1);
    border-radius: 24px;
    padding: 25px;
    transition: all 0.3s ease;
    position: relative;
    overflow: hidden;
}

.card::before {
    content: '';
    position: absolute;
    top: 0;
    left: 0;
    right: 0;
    height: 4px;
    background: linear-gradient(90deg, #4a9eff, #8b5cf6);
    opacity: 0;
    transition: opacity 0.3s;
}

.card:hover {
    transform: translateY(-8px);
    border-color: rgba(74, 158, 255, 0.4);
    box-shadow: 0 20px 40px rgba(0, 0, 0, 0.4);
}

.card:hover::before {
    opacity: 1;
}

.card div:first-child {
    color: #94a3b8;
    font-size: 0.85rem;
    text-transform: uppercase;
    letter-spacing: 1.5px;
    font-weight: 600;
    margin-bottom: 15px;
}

.kpi-value {
    font-size: 2.8rem;
    font-weight: 700;
    line-height: 1;
    margin-bottom: 8px;
}

/* KPI Colors with Gradients */
.primary { 
    background: linear-gradient(135deg, #4a9eff, #60a5fa);
    -webkit-background-clip: text;
    -webkit-text-fill-color: transparent;
}
.danger { 
    background: linear-gradient(135deg, #ef4444, #f87171);
    -webkit-background-clip: text;
    -webkit-text-fill-color: transparent;
}
.success { 
    background: linear-gradient(135deg, #10b981, #34d399);
    -webkit-background-clip: text;
    -webkit-text-fill-color: transparent;
}

/* ============ CHART CARDS ============ */
.chart-card {
    background: linear-gradient(145deg, rgba(30, 41, 59, 0.8), rgba(15, 23, 42, 0.9));
    backdrop-filter: blur(10px);
    border: 1px solid rgba(74, 158, 255, 0.1);
    border-radius: 28px;
    padding: 30px;
    margin-bottom: 30px;
    transition: border-color 0.3s;
}

.chart-card:hover {
    border-color: rgba(74, 158, 255, 0.3);
}

.donut-wrapper {
    height: 320px;
    display: flex;
    justify-content: center;
    align-items: center;
    position: relative;
}

canvas {
    max-width: 280px !important;
    max-height: 280px !important;
    filter: drop-shadow(0 10px 20px rgba(0, 0, 0, 0.3));
}

/* ============ CUSTOM LEGEND ============ */
.custom-legend {
    display: flex;
    justify-content: center;
    gap: 35px;
    margin-top: 20px;
    flex-wrap: wrap;
}

.custom-legend div {
    display: flex;
    align-items: center;
    gap: 8px;
    font-size: 0.95rem;
    font-weight: 500;
    padding: 8px 18px;
    background: rgba(255, 255, 255, 0.03);
    border-radius: 40px;
    border: 1px solid rgba(255, 255, 255, 0.05);
}

/* ============ TABLE DESIGN ============ */
table {
    width: 100%;
    border-collapse: separate;
    border-spacing: 0 8px;
    margin-top: 10px;
}

th {
    text-align: left;
    padding: 15px 15px;
    color: #94a3b8;
    font-weight: 600;
    font-size: 0.85rem;
    text-transform: uppercase;
    letter-spacing: 1px;
    background: rgba(0, 0, 0, 0.2);
    border-radius: 12px 12px 0 0;
}

td {
    padding: 16px 15px;
    background: rgba(30, 41, 59, 0.4);
    border: none;
    color: #e2e8f0;
    font-size: 0.95rem;
    transition: background 0.2s;
}

tr:hover td {
    background: rgba(74, 158, 255, 0.08);
}

/* ============ BADGES - MODERN ============ */
.badge {
    padding: 6px 14px;
    border-radius: 40px;
    font-size: 0.75rem;
    font-weight: 600;
    text-transform: uppercase;
    letter-spacing: 0.5px;
    display: inline-block;
    border: 1px solid rgba(255, 255, 255, 0.1);
}

.badge-high { 
    background: linear-gradient(145deg, rgba(231, 76, 60, 0.2), rgba(231, 76, 60, 0.1));
    color: #ff8a8a;
    border-color: rgba(231, 76, 60, 0.3);
}
.badge-medium { 
    background: linear-gradient(145deg, rgba(243, 156, 18, 0.2), rgba(243, 156, 18, 0.1));
    color: #fbbf24;
    border-color: rgba(243, 156, 18, 0.3);
}
.badge-low { 
    background: linear-gradient(145deg, rgba(46, 204, 113, 0.2), rgba(46, 204, 113, 0.1));
    color: #6ee7b7;
    border-color: rgba(46, 204, 113, 0.3);
}

/* ============ LAYOUT IMPROVEMENTS ============ */
.factors-container {
    display: grid;
    grid-template-columns: 1fr 1fr;
    gap: 30px;
}

/* ============ CUSTOM SCROLLBAR ============ */
::-webkit-scrollbar {
    width: 8px;
    height: 8px;
}

::-webkit-scrollbar-track {
    background: #0f172a;
}

::-webkit-scrollbar-thumb {
    background: #334155;
    border-radius: 10px;
}

::-webkit-scrollbar-thumb:hover {
    background: #4a9eff;
}

/* ============ RESPONSIVE ============ */
@media (max-width: 1200px) {
    .row {
        grid-template-columns: repeat(2, 1fr);
    }
}

@media (max-width: 768px) {
    .container { padding: 20px; }
    .row { grid-template-columns: 1fr; }
    h2 { font-size: 1.8rem; }
    .kpi-value { font-size: 2.2rem; }
}

/* FIX FOR ROW 2 - EQUAL HEIGHT */
.chart-row {
    display: grid;
    grid-template-columns: 1fr 1fr;
    gap: 30px;
    align-items: stretch;
}

.chart-row .chart-card {
    height: 100%;
}
/* ===== SIDEBAR LAYOUT ===== */
.sidebar {
    width: 260px;
    background: #10141c;
    border-right: 1px solid #222a36;
    padding: 2rem 1.5rem;
    display: flex;
    flex-direction: column;
}

.logo-area {
    display: flex;
    align-items: center;
    gap: 12px;
    margin-bottom: 3rem;
}

.logo-area i {
    font-size: 1.6rem;
    color: #3b82f6;
}

.logo-area span {
    font-weight: 600;
    font-size: 1rem;
    line-height: 1.3;
}

.nav {
    display: flex;
    flex-direction: column;
    gap: 10px;
    flex: 1;
}

.nav-item {
    padding: 12px 16px;
    border-radius: 14px;
    font-weight: 500;
    color: #8e9aaf;
    cursor: pointer;
    transition: 0.2s;
}

.nav-item:hover {
    background: #1a212b;
    color: #ccddf8;
}

.nav-item.active {
    background: #1f2a37;
    color: white;
    border-left: 3px solid #3b82f6;
}

.main {
    flex: 1;
}

</style>
</head>
<body>

<!-- SIDEBAR -->
<aside class="sidebar">
    <div class="logo-area">
        <i class="fas fa-dumbbell"></i>
        <span>
            Gym Customer<br>
            Churn Prediction
        </span>
    </div>

    <div class="nav">
        <div class="nav-item active" onclick="window.location.href='/dashboard'">
            ðŸ“Š Overview
        </div>
        <div class="nav-item" onclick="window.location.href='/prediction'">
            ðŸ”® Prediction
        </div>
        <div class="nav-item" onclick="window.location.href='/suggestions'">
            ðŸ’¡ Suggestions
        </div>
    </div>
</aside>

<!-- MAIN WRAPPER -->
<main class="main">
<div class="container">




<!-- ROW 1: KPI CARDS - MODERN GLASS -->
<div class="row">
    <div class="card">
        <div><i class="fas fa-exclamation-triangle" style="margin-right: 8px;"></i> At-Risk Members</div>
        <div id="atRisk" class="kpi-value danger">-</div>
        <div style="color: #64748b; font-size: 0.8rem;">â†‘ 12% from last month</div>
    </div>
    <div class="card">
        <div><i class="fas fa-chart-line"></i> Likely to Churn %</div>
        <div id="churnProb" class="kpi-value primary">-</div>
        <div style="color: #64748b; font-size: 0.8rem;">â†“ 4% improvement</div>
    </div>
    <div class="card">
        <div><i class="fas fa-user-slash"></i> Actual Churn Rate %</div>
        <div id="churnRate" class="kpi-value danger">-</div>
        <div style="color: #64748b; font-size: 0.8rem;">Target: 15%</div>
    </div>
    <div class="card">
        <div><i class="fas fa-calendar-check"></i> Avg Visits / Month</div>
        <div id="avgVisits" class="kpi-value success">-</div>
        <div style="color: #64748b; font-size: 0.8rem;">â†‘ 0.7 vs last month</div>
    </div>
</div>

<!-- ROW 2: TWO CHARTS SIDE BY SIDE -->
<div style="display: grid; grid-template-columns: 1fr 1fr; gap: 30px; margin-bottom: 30px; align-items: stretch;">
    
    <!-- CHART 1: RISK DISTRIBUTION -->
    <div class="chart-card" style="margin-bottom: 0; height: 100%;">
        <h3>
            <i class="fas fa-chart-pie" style="color: #4a9eff;"></i>
            Churn Risk Distribution
        </h3>
        <div class="donut-wrapper" style="height: 280px;">
            <canvas id="riskChart"></canvas>
        </div>
        <div id="riskLegend" class="custom-legend"></div>
    </div>
    
    <!-- CHART 2: KEY FACTORS - CUSTOM PROGRESS BARS -->
    <div class="chart-card" style="margin-bottom: 0; height: 100%; display: flex; flex-direction: column;">
        <h3>
            <i class="fas fa-chart-bar" style="color: #4a9eff;"></i>
            Key Factors Impacting Churn
        </h3>
        <div id="factorContainer" style="flex: 1; padding: 10px 15px; display: flex; flex-direction: column; justify-content: space-around;">
            <!-- Progress bars will be injected here by JavaScript -->
        </div>
        <canvas id="factorChart" style="display: none;"></canvas>
    </div>
    
</div>

<!-- ROW 3: TABLE (now comes after side-by-side charts) -->
<div class="chart-card">
    <h3>
        <i class="fas fa-users" style="color: #4a9eff;"></i>
        High-Risk Members (Top 10)
        <span style="margin-left: auto; font-size: 0.9rem; color: #94a3b8; font-weight: normal;">
            <i class="fas fa-sort"></i> Priority Order
        </span>
    </h3>
    <table>
        <thead>
            <tr>
                <th>Customer ID</th>
                <th>Monthly Visits</th>
                <th>Complaints</th>
                <th>Membership Months</th>
                <th>Risk Level</th>
                
            </tr>
        </thead>
        <tbody id="riskTable"></tbody>
    </table>
</div>



</div>

<script>
// ============================
// YOUR API CALLS - UNCHANGED
// ============================
fetch('/api/kpis')
.then(res => res.json())
.then(data => {
    document.getElementById('atRisk').innerText = data.at_risk_count;
    document.getElementById('churnProb').innerText = data.churn_probability + "%";
    document.getElementById('churnRate').innerText = data.churn_rate + "%";
    document.getElementById('avgVisits').innerText = data.avg_visits;
})
.catch(err => console.error('KPI Error:', err));

// ============================
// RISK DISTRIBUTION
// ============================
fetch('/api/risk-distribution')
.then(res => res.json())
.then(data => {
    const total = data.low_risk + data.medium_risk + data.high_risk;
    const lowPercent = ((data.low_risk / total) * 100).toFixed(1);
    const mediumPercent = ((data.medium_risk / total) * 100).toFixed(1);
    const highPercent = ((data.high_risk / total) * 100).toFixed(1);

    new Chart(document.getElementById('riskChart'), {
        type: 'doughnut',
        data: {
            labels: ['Low Risk', 'Medium Risk', 'High Risk'],
            datasets: [{
                data: [data.low_risk, data.medium_risk, data.high_risk],
                backgroundColor: ['#2ecc71', '#f39c12', '#e74c3c'],
                borderWidth: 0,
                borderRadius: 8,
                spacing: 5
            }]
        },
        options: {
            responsive: true,
            maintainAspectRatio: false,
            cutout: '70%',
            plugins: {
                legend: { display: false },
                tooltip: { backgroundColor: '#1e293b' }
            }
        }
    });

    document.getElementById('riskLegend').innerHTML = `
        <div style="color:#2ecc71;"><i class="fas fa-circle" style="font-size: 10px;"></i> Low Risk (${lowPercent}%)</div>
        <div style="color:#f39c12;"><i class="fas fa-circle" style="font-size: 10px;"></i> Medium Risk (${mediumPercent}%)</div>
        <div style="color:#e74c3c;"><i class="fas fa-circle" style="font-size: 10px;"></i> High Risk (${highPercent}%)</div>
    `;
})
.catch(err => console.error('Risk Distribution Error:', err));

// ============================
// CHURN FACTORS
// ============================
// ============================
// CHURN FACTORS - HTML PROGRESS BARS
// ============================
fetch('/api/churn-factors')
.then(res => res.json())
.then(data => {
    // Map raw column names to clean display names
    const cleanNames = {
        'num_logins': 'Low Gym Visits',
        'num_complaints': 'High Complaint Count',
        'subscription_length': 'Short Subscription Length',
        'num_classes_attended': 'Low Class Attendance',
        'avg_session_time': 'Short Session Time',
        'payment_delays': 'Payment Issues',
        'referral_status': 'No Referrals',
        'distance_from_gym': 'Far Distance'
    };
    
    // Get top 4 and convert to percentages
    let top4 = data
        .sort((a, b) => Math.abs(b.importance) - Math.abs(a.importance))
        .slice(0, 4)
        .map(item => {
            let value = item.importance;
            if (value > -1 && value < 1) {
                value = value * 100;
            }
            value = Math.round(value);
            
            return {
                feature: cleanNames[item.feature] || item.feature.replace(/_/g, ' '),
                importance: value
            };
        });
    
    // Generate HTML for progress bars
    let html = '';
    
    top4.forEach(item => {
        const value = item.importance;
        const isNegative = value < 0;
        const absValue = Math.abs(value);
        const barColor = isNegative ? '#ef4444' : '#4a9eff';
        const barWidth = Math.min(absValue, 100); // Cap at 100%
        
        html += `
            <div style="margin-bottom: 25px;">
                <div style="display: flex; justify-content: space-between; margin-bottom: 8px;">
                    <span style="color: #e2e8f0; font-weight: 500;">${item.feature}</span>
                    <span style="color: ${barColor}; font-weight: 700;">${value}%</span>
                </div>
                <div style="position: relative; height: 36px; background: #334155; border-radius: 8px; overflow: hidden;">
                    <div style="width: ${barWidth}%; height: 100%; background: ${barColor}; border-radius: 8px; transition: width 0.3s;"></div>
                    <div style="position: absolute; top: 0; left: 0; right: 0; bottom: 0; display: flex; align-items: center; padding-left: 12px; color: white; font-weight: 500; pointer-events: none;">
                        ${isNegative ? 'ðŸ”»' : 'ðŸ“ˆ'} Impact
                    </div>
                </div>
                <div style="display: flex; justify-content: space-between; margin-top: 4px;">
                    <span style="color: #94a3b8; font-size: 12px;">0%</span>
                    <span style="color: #94a3b8; font-size: 12px;">100%</span>
                </div>
            </div>
        `;
    });
    
    document.getElementById('factorContainer').innerHTML = html;
    
    // Create dummy chart to prevent errors
    new Chart(document.getElementById('factorChart'), {
        type: 'bar',
        data: { labels: [], datasets: [] },
        options: { responsive: true, maintainAspectRatio: false }
    });
})
.catch(err => console.error('Churn Factors Error:', err));
// ============================
// CHURN FACTORS - PROGRESS BAR STYLE
// ============================
fetch('/api/churn-factors')
.then(res => res.json())
.then(data => {
    console.log('Raw API data:', data);
    
    // Map raw column names to clean display names
    const cleanNames = {
        'num_logins': 'Low Gym Visits',
        'num_complaints': 'High Complaint Count',
        'subscription_length': 'Short Subscription Length',
        'num_classes_attended': 'High Class Attendance',
        'avg_session_time': 'Short Session Time',
        'payment_delays': 'Payment Issues',
        'referral_status': 'No Referrals',
        'distance_from_gym': 'Far Distance'
    };
    
    // Get top 4 and convert to percentages
    let top4 = data
        .sort((a, b) => {
            // Sort by absolute importance value
            return Math.abs(b.importance) - Math.abs(a.importance);
        })
        .slice(0, 4)
        .map(item => {
            // Convert decimal to percentage
            let value = item.importance;
            if (value > -1 && value < 1) {
                value = value * 100;
            }
            value = Math.round(value);
            
            return {
                feature: cleanNames[item.feature] || item.feature.replace(/_/g, ' '),
                importance: value,
                raw_feature: item.feature
            };
        });
    
    console.log('Top 4 formatted:', top4);
    
    // Get the chart canvas
    const canvas = document.getElementById('factorChart');
    const ctx = canvas.getContext('2d');
    
    // Clear canvas
    ctx.clearRect(0, 0, canvas.width, canvas.height);
    
    // Set dimensions
    canvas.height = 250;
    canvas.width = canvas.clientWidth;
    
    const barHeight = 35;
    const startY = 50;
    const startX = 200;
    const barWidth = canvas.width - startX - 80;
    
    // Draw title
    ctx.font = 'bold 16px Inter, Arial, sans-serif';
    ctx.fillStyle = '#fff';
    ctx.fillText('Key Factors Impacting Churn', 20, 30);
    
    // Draw each factor
    top4.forEach((item, index) => {
        const y = startY + (index * (barHeight + 15));
        const value = item.importance;
        const isNegative = value < 0;
        const absValue = Math.abs(value);
        
        // Draw label
        ctx.font = '14px Inter, Arial, sans-serif';
        ctx.fillStyle = '#e2e8f0';
        ctx.fillText(item.feature, 20, y + 20);
        
        // Draw background bar (light gray)
        ctx.fillStyle = '#334155';
        ctx.fillRect(startX, y, barWidth, barHeight);
        
        // Draw colored progress bar
        let progressWidth = (absValue / 100) * barWidth;
        if (progressWidth > barWidth) progressWidth = barWidth;
        
        if (isNegative) {
            // Negative value - red bar going left from center?
            // For now, we'll show it as a red bar from the left
            ctx.fillStyle = '#ef4444';
            ctx.fillRect(startX, y, progressWidth, barHeight);
        } else {
            // Positive value - blue bar
            ctx.fillStyle = '#4a9eff';
            ctx.fillRect(startX, y, progressWidth, barHeight);
        }
        
        // Draw percentage text
        ctx.font = 'bold 14px Inter, Arial, sans-serif';
        ctx.fillStyle = isNegative ? '#ef4444' : '#4a9eff';
        ctx.fillText(`${value}%`, startX + progressWidth + 10, y + 25);
        
        // Draw "0%" marker at start
        ctx.font = '12px Inter, Arial, sans-serif';
        ctx.fillStyle = '#64748b';
        ctx.fillText('0%', startX - 35, y + 25);
        
        // Draw "100%" marker at end
        ctx.fillStyle = '#64748b';
        ctx.fillText('100%', startX + barWidth + 10, y + 25);
    });
    
    // Also create a hidden Chart.js instance to prevent errors
    // (your code might expect it to exist)
    new Chart(document.getElementById('factorChart'), {
        type: 'bar',
        data: {
            labels: top4.map(item => item.feature),
            datasets: [{
                data: top4.map(item => item.importance),
                backgroundColor: 'transparent',
                borderColor: 'transparent'
            }]
        },
        options: {
            responsive: true,
            maintainAspectRatio: false,
            plugins: { legend: { display: false } },
            scales: { x: { display: false }, y: { display: false } }
        }
    });
    
})
.catch(err => console.error('Churn Factors Error:', err));

// ============================
// HIGH RISK MEMBERS
// ============================
fetch('/api/high-risk-members')
.then(res => res.json())
.then(data => {
    const table = document.getElementById('riskTable');
    table.innerHTML = '';
    
    data.slice(0, 10).forEach(member => {
        const row = document.createElement('tr');
        let badgeClass = "badge-low";
        if (member.risk_level === "High") badgeClass = "badge-high";
        if (member.risk_level === "Medium") badgeClass = "badge-medium";

        row.innerHTML = `
            <td><span style="font-family: monospace; font-weight: 600;">${member.customer_id}</span></td>
            <td>${member.num_logins} <span style="color: #64748b;">/mo</span></td>
            <td>${member.num_complaints}</td>
            <td>${member.subscription_length} <span style="color: #64748b;">mos</span></td>
            <td><span class="badge ${badgeClass}">${member.risk_level}</span></td>
            
        `;
        table.appendChild(row);
    });
})
.catch(err => console.error('High Risk Members Error:', err));
</script>
</main>

</body>
</html>




<style>
    /* KPI Card styling matching your existing dashboard */
    .matrix-kpi-card {
        background: var(--card-bg);
        border-radius: 12px;
        border-left: 5px solid var(--primary-color);
        padding: 20px;
        margin-top: 20px;
        box-shadow: 0 4px 6px rgba(0, 0, 0, 0.1);
    }

    .matrix-mini-container {
        display: flex;
        flex-direction: column;
        gap: 15px;
        margin-top: 15px;
    }

    /* Mini Matrix Grid */
    .matrix-mini-grid {
        display: flex;
        flex-direction: column;
        gap: 8px;
    }

    .matrix-mini-header {
        display: grid;
        grid-template-columns: 100px 1fr 1fr;
        gap: 8px;
        margin-bottom: 4px;
    }

    .matrix-mini-row {
        display: grid;
        grid-template-columns: 100px 1fr 1fr;
        gap: 8px;
    }

    .matrix-mini-corner {
        grid-column: 1;
    }

    .matrix-mini-label {
        font-size: 0.8rem;
        font-weight: 600;
        padding: 6px;
        text-align: center;
        background: rgba(45, 55, 72, 0.5);
        border-radius: 6px;
        color: var(--text-secondary);
    }

    .matrix-mini-label.predicted {
        color: var(--primary-color);
    }

    .matrix-mini-label.actual {
        color: var(--warning-color);
    }

    .matrix-mini-cell {
        padding: 8px;
        text-align: center;
        font-size: 1.2rem;
        font-weight: 600;
        border-radius: 6px;
        background: rgba(45, 55, 72, 0.3);
    }

    .matrix-mini-cell.tn {
        color: #2ecc71;
        background: rgba(46, 204, 113, 0.1);
        border: 1px solid rgba(46, 204, 113, 0.2);
    }

    .matrix-mini-cell.fp {
        color: #e74c3c;
        background: rgba(231, 76, 60, 0.1);
        border: 1px solid rgba(231, 76, 60, 0.2);
    }

    .matrix-mini-cell.fn {
        color: #e74c3c;
        background: rgba(231, 76, 60, 0.1);
        border: 1px solid rgba(231, 76, 60, 0.2);
    }

    .matrix-mini-cell.tp {
        color: #2ecc71;
        background: rgba(46, 204, 113, 0.1);
        border: 1px solid rgba(46, 204, 113, 0.2);
    }

    /* Mini Metrics Row */
    .matrix-mini-metrics {
        display: grid;
        grid-template-columns: repeat(4, 1fr);
        gap: 10px;
        padding-top: 10px;
        border-top: 1px solid var(--card-border);
    }

    .matrix-mini-metric {
        text-align: center;
        padding: 8px;
        background: rgba(45, 55, 72, 0.3);
        border-radius: 6px;
    }

    .matrix-mini-metric-label {
        display: block;
        color: var(--text-secondary);
        font-size: 0.7rem;
        font-weight: 600;
        text-transform: uppercase;
        letter-spacing: 0.5px;
        margin-bottom: 4px;
    }

    .matrix-mini-metric-value {
        display: block;
        color: var(--text-primary);
        font-size: 1rem;
        font-weight: 600;
    }

    /* Responsive */
    @media (max-width: 768px) {
        .matrix-mini-header,
        .matrix-mini-row {
            grid-template-columns: 80px 1fr 1fr;
        }
        
        .matrix-mini-label {
            font-size: 0.7rem;
            padding: 4px;
        }
        
        .matrix-mini-cell {
            font-size: 1rem;
            padding: 6px;
        }
    }
</style>

<script>
    async function loadConfusionMatrix() {
        const cells = {
            tn: document.getElementById('cell-tn'),
            fp: document.getElementById('cell-fp'),
            fn: document.getElementById('cell-fn'),
            tp: document.getElementById('cell-tp')
        };

        const metrics = {
            accuracy: document.getElementById('accuracy'),
            precision: document.getElementById('precision'),
            recall: document.getElementById('recall'),
            f1: document.getElementById('f1')
        };

        // Show loading state
        Object.values(cells).forEach(cell => cell.classList.add('loading'));
        Object.values(metrics).forEach(metric => metric.classList.add('loading'));

        try {
            const response = await fetch('/api/confusion-matrix');
            const data = await response.json();

            // Validate data
            const required = ['tn', 'fp', 'fn', 'tp'];
            if (!required.every(key => key in data)) {
                throw new Error('Invalid response format');
            }

            // Update cell values
            cells.tn.textContent = data.tn;
            cells.fp.textContent = data.fp;
            cells.fn.textContent = data.fn;
            cells.tp.textContent = data.tp;

            // Calculate metrics
            const total = data.tn + data.fp + data.fn + data.tp;
            const accuracy = ((data.tn + data.tp) / total * 100).toFixed(1);
            const precision = data.tp / (data.tp + data.fp) * 100;
            const recall = data.tp / (data.tp + data.fn) * 100;
            const f1 = 2 * (precision * recall) / (precision + recall);

            // Update metrics
            metrics.accuracy.textContent = `${accuracy}%`;
            metrics.precision.textContent = `${precision.toFixed(1)}%`;
            metrics.recall.textContent = `${recall.toFixed(1)}%`;
            metrics.f1.textContent = `${f1.toFixed(1)}%`;

            // Remove loading state
            Object.values(cells).forEach(cell => cell.classList.remove('loading'));
            Object.values(metrics).forEach(metric => metric.classList.remove('loading'));

        } catch (error) {
            console.error('Error loading confusion matrix:', error);
            
            // Show error state
            Object.values(cells).forEach(cell => {
                cell.classList.remove('loading');
                cell.textContent = 'Error';
            });
            
            Object.values(metrics).forEach(metric => {
                metric.classList.remove('loading');
                metric.textContent = 'Error';
            });
        }
    }

    // Load when page loads
    document.addEventListener('DOMContentLoaded', loadConfusionMatrix);

    // Refresh every 30 seconds
    setInterval(loadConfusionMatrix, 30000);
</script>